console.log("Page Loaded");var Input=function(){function a(a){var b=a.keyCode,c=String.fromCharCode(b);9===b&&(a.preventDefault(),ED.dispatchEvent({type:"tab"})),-1!==f.indexOf(c)&&(a.preventDefault(),d[c]=!0,e&&console.log(c)," "===c&&ED.dispatchEvent({type:"space"}),"Q"===c&&ED.dispatchEvent({type:"jump"}),"E"===c&&ED.dispatchEvent({type:"fire"}),"P"===c&&ED.dispatchEvent({type:"print"}))}function b(a){var b=a.keyCode,c=String.fromCharCode(b);-1!==f.indexOf(c)&&(a.preventDefault(),d[c]=!1,e&&console.log(c))}function c(){window.addEventListener("keydown",a),window.addEventListener("keyup",b)}var d={},e=!1,f="ASDQWEZXCVBNP ";return{init:c,keys:d}}(),Loader=function(){function a(){f.load()}var b="images/",c={backgroundImage:"background3.png",foregroundImage:"foreground3.png",gamespaceImage:"random_trans.png",atlasJson:"atlas.json",atlasImage:"atlas.png",sslAnim:"ssl.anim",fireballAnim:"fireball.anim",ultiAnim:"ulti.anim",groundAnim:"ground.anim",flAnim:"fl.anim",gcAnim:"gc.anim",jfAnim:"jf.anim",lfAnim:"lf.anim",octopusAnim:"octopus.anim",sgAnim:"sg.anim",sfAnim:"sf.anim",gfAnim:"gf.anim",turtleAnim:"turtle.anim",lobsterAnim:"lobster.anim",c1Anim:"c1.anim",c2Anim:"c2.anim"},d={};_.each(c,function(a,c){d[c]=b+a});var e=_.map(c,function(a){return b+a}),f=new PIXI.AssetLoader(e);return f.onComplete=function(){Background.init(),Foreground.init(),Gamespace.init(),FireButton.init(),JumpButton.init(),Enemy.load();for(var a in World.circles){var b=World.circles[a];b.init()}for(var c in World.dashes){var d=World.dashes[c];d.init()}Renderer.play()},{assets:c,path:d,load:a}}(),stats=new Stats;stats.setMode(0),stats.domElement.style.position="absolute",stats.domElement.style.left="0px",stats.domElement.style.top="0px",document.body.appendChild(stats.domElement);var Screen=function(){var a=1136,b=640,c=new PIXI.Stage(15794175,!0);return{width:a,height:b,stage:c}}(),Layer=function(a){this.unit=a};Layer.prototype.width=20480,Layer.prototype.height=2048,Layer.prototype.imageWidth=5120,Layer.prototype.imageHeight=512,Layer.prototype.init=function(){this.sprite.x=Screen.width/2,this.sprite.y=Screen.height/2,this.sprite.scale={x:this.scale,y:this.scale},Screen.stage.addChild(this.sprite)},Layer.prototype.focus=function(a,b){var c=a.x/Layer.prototype.width,d=a.y/Layer.prototype.height;this.sprite.scale={x:this.scale*this.unit*b,y:this.scale*this.unit*b},this.sprite.x=Screen.width/2-a.x+this.width*(1-this.unit*b)*c,this.sprite.y=Screen.height/2-a.y+this.height*(1-this.unit*b)*d};var Background=new Layer(.6);Background.init=function(){this.sprite=new PIXI.DisplayObjectContainer;var a=PIXI.Texture.fromImage(Loader.path.backgroundImage);this.tiles=new PIXI.TilingSprite(a,Layer.prototype.imageWidth,Layer.prototype.imageHeight),this.sprite.addChild(this.tiles),this.scale=4,Layer.prototype.init.call(this)};var Foreground=new Layer(.8);Foreground.init=function(){var a=PIXI.Texture.fromImage(Loader.path.foregroundImage);this.sprite=new PIXI.TilingSprite(a,Layer.prototype.imageWidth,Layer.prototype.imageHeight),this.scale=4,Layer.prototype.init.call(this)};var Gamespace=new Layer(1);Gamespace.init=function(){this.isEditing=!1,this.enemyID=1,ED.addEventListener("tab",Gamespace.edit),ED.addEventListener("new",Gamespace.spawn),ED.addEventListener("space",Gamespace.change),this.sprite=new PIXI.DisplayObjectContainer;var a=PIXI.Texture.fromImage(Loader.path.gamespaceImage);this.tiles=new PIXI.TilingSprite(a,this.width,this.height),this.tiles.visible=!1,this.sprite.setInteractive(!0),this.sprite.hitArea=new PIXI.Rectangle(0,0,Layer.prototype.width,Layer.prototype.height),this.sprite.mousedown=function(a){var b=a.getLocalPosition(Gamespace.sprite);Gamespace.isEditing&&ED.dispatchEvent({type:"new",position:b})},this.sprite.addChild(this.tiles),this.scale=1,Layer.prototype.init.call(this)},Gamespace.edit=function(){Gamespace.isEditing=!Gamespace.isEditing,Gamespace.tiles.visible=Gamespace.isEditing},Gamespace.change=function(){Gamespace.isEditing&&(Gamespace.enemyID++,Gamespace.enemyID>10&&(Gamespace.enemyID=1))},Gamespace.spawn=function(a){{var b=a.position;new Enemy(Gamespace.enemyID,b)}AllEnemies.push({enemyid:Gamespace.enemyID,position:b})};var FireButton=function(){function a(){var a=new PIXI.Sprite.fromFrame("fire_button.png");a.setInteractive(!0),a.anchor={x:.5,y:.5},a.scale={x:2,y:2},a.x=Screen.width-100,a.y=Screen.height/2,a.tap=function(){ED.dispatchEvent({type:"fire"})},Screen.stage.addChild(a)}return{init:a}}(),JumpButton=function(){function a(){var a=new PIXI.Sprite.fromFrame("jump_button.png");a.setInteractive(!0),a.anchor={x:.5,y:.5},a.scale={x:2,y:2},a.x=100,a.y=Screen.height/2,a.tap=function(){ED.dispatchEvent({type:"jump"})},Screen.stage.addChild(a)}return{init:a}}(),World=function(){};World.circles=[],World.dashes=[],World.render=function(){for(var a in World.circles){var b=World.circles[a];b.render()}};var Dash=function(a,b){this.position=a,this.length=b,World.dashes.push(this)},Circle=function(a,b){this.position=a||{x:0,y:0},this.x=this.position.x,this.y=this.position.y,this.vx=0,this.vy=0,this.ax=0,this.ay=0,this.length=b,a&&World.circles.push(this)};Circle.prototype.render=function(){this.vx=this.vx+this.ax,this.vy=this.vy+this.ay,this.vx=this.vx<-this.mvx?-this.mvx:this.vx,this.vx=this.vx>this.mvx?this.mvx:this.vx,this.vy=this.vy<-this.mvy?-this.mvy:this.vy,this.vy=this.vy>this.mvy?this.mvy:this.vy,this.x=this.x+this.vx,this.y=this.y+this.vy,this.x=this.x<0?0:this.x,this.x=this.x>Gamespace.width?Gamespace.width:this.x,this.y=this.y<0?0:this.y,this.y=this.y>Gamespace.height?Gamespace.height:this.y,this.position={x:this.x,y:this.y},this.sprite.position={x:this.x,y:this.y}},Circle.prototype.collideCircle=function(a){var b=this.position.x,c=this.position.y,d=a.position.x,e=a.position.y,f=(b-d)*(b-d)+(c-e)*(c-e),g=(this.length+a.length)*(this.length+a.length);return g>f},Circle.prototype.collideDash=function(a){var b=this.position.x,c=this.position.y,d=a.position.x,e=a.position.y,f=this.length,g=a.length;return d>b?0:b>d+g?0:e-f>c?0:c>e+f?0:e>c?-1:1},Circle.prototype.inWater=function(){return this.y<1024?!1:!0},Circle.prototype.gravity=function(){return this.y<1024?.7:0};var SSL=new Circle({x:500,y:1024},80);console.log(SSL),SSL.init=function(){ED.addEventListener("jump",SSL.jump),ED.addEventListener("fire",SSL.fire),this.mvx=10,this.mvy1=100,this.mvy2=20,this.speed=1,this.sprite=new PIXI.Spine(Loader.path.sslAnim),this.sprite.position=this.position,this.sprite.scale={x:.5,y:.5},this.sprite.state.setAnimationByName("swim",!0),Gamespace.sprite.addChild(this.sprite),this.vx=3},SSL.render=function(){this.ay=this.gravity();var a=this.sprite.state;"jump"===a.current.name&&a.isComplete()&&a.setAnimationByName("run");for(var b in World.dashes){var c=World.dashes[b],d=this.collideDash(c);0!==d&&(-1===d?(this.vy>0&&(this.vy=0),this.ay>0&&(this.ay=0)):1===d&&(this.vy<0&&(this.vy=-.5*this.vy),this.ay<0&&(this.ay=0)))}this.y>1024&&a.isComplete()&&a.setAnimationByName("swim",!0),this.mvy=this.inWater()?this.mvy1:this.mvy2,Circle.prototype.render.call(SSL)},SSL.jump=function(){if(SSL.inWater())0===SSL.vy?SSL.vy=-15:SSL.vy<0?SSL.vy=5:SSL.vy>0&&(SSL.vy=-8);else{if("jump"===SSL.sprite.state.current.name&&!SSL.sprite.state.isComplete())return;SSL.sprite.state.setAnimationByName("jump"),SSL.vy=-25}SSL.sprite.state.setAnimationByName("jump")},SSL.fire=function(){if(SSL.canFire){if("fire"===SSL.sprite.state.current.name&&!SSL.sprite.state.isComplete())return;SSL.sprite.state.setAnimationByName("fire"),FB.x=SSL.x,FB.y=SSL.y,FB.sprite.state.setAnimationByName("fire",!0)}else{if("flip"===SSL.sprite.state.current.name&&!SSL.sprite.state.isComplete())return;SSL.sprite.state.setAnimationByName("flip")}};var Fireball=function(a){Circle.prototype.constructor.call(this,a,40)};Fireball.prototype.init=function(){this.vx=24,this.sprite=new PIXI.Spine(Loader.path.fireballAnim),this.sprite.position=this.position,this.sprite.scale={x:.5,y:.5},this.sprite.state.setAnimationByName("fire",!0),Gamespace.sprite.addChild(this.sprite)},Fireball.prototype.render=function(){this.sprite.state.isComplete()&&(this.x=0),Circle.prototype.render.call(this)};var FB=new Fireball({x:0,y:1024}),Floor=function(a,b){this.n=b,this.position=a,Dash.prototype.constructor.call(this,a,64*b)};Floor.prototype.init=function(){console.log(this);for(var a=0;a<this.n;a++){var b=new PIXI.Spine(Loader.path.groundAnim);b.position.x=this.position.x+64*a,b.position.y=this.position.y,b.state.setAnimationByName("default",!0),Gamespace.sprite.addChildAt(b,0)}};var ceiling1=new Dash({x:0,y:0},20480);ceiling1.init=function(){};var ceiling2=new Dash({x:0,y:2048},20480);ceiling2.init=function(){};var f1=new Floor({x:1500,y:1024},50),AllEnemies=[{enemyid:1,position:{x:4867.690666666667,y:1293.8770381875106}},{enemyid:1,position:{x:5434.528,y:1297.9161871656434}},{enemyid:2,position:{x:6467.623111111112,y:994.9800138056848}},{enemyid:2,position:{x:8684.561777777777,y:990.9408648275521}},{enemyid:2,position:{x:13564.561777777777,y:990.9408648275521}},{enemyid:3,position:{x:15029.187555555556,y:1185.7105709051089}},{enemyid:3,position:{x:14302.606222222223,y:1475.0020928882097}},{enemyid:3,position:{x:11125.923555555555,y:1534.8625634803943}},{enemyid:3,position:{x:8257.582222222223,y:1507.7314870634978}},{enemyid:3,position:{x:6907.879111111111,y:1383.223713988111}},{enemyid:3,position:{x:9874.13688888889,y:1181.7218774319952}},{enemyid:4,position:{x:9033.091555555555,y:1315.5744890663905}},{enemyid:4,position:{x:7913.159111111112,y:1133.8127850504154}},{enemyid:4,position:{x:7756.807111111111,y:1557.9234277543574}},{enemyid:4,position:{x:6305.404444444444,y:1517.5319379730295}},{enemyid:5,position:{x:5896.739555555556,y:1263.0655523506643}},{enemyid:5,position:{x:4995.242666666667,y:1473.1012992135688}},{enemyid:5,position:{x:6797.070222222223,y:1295.3787441757265}},{enemyid:5,position:{x:7802.087111111112,y:1287.300446219461}},{enemyid:5,position:{x:7688.600888888889,y:1473.1012992135688}},{enemyid:6,position:{x:7937.461333333334,y:439.0791608115769}},{enemyid:6,position:{x:8135.377777777778,y:216.92596701427408}},{enemyid:6,position:{x:7674.919111111111,y:334.06128738012467}},{enemyid:6,position:{x:7189.120000000001,y:560.2536301555604}},{enemyid:6,position:{x:5786.3822222222225,y:627.5489485491703}},{enemyid:6,position:{x:4720.192,y:661.2323546088799}},{enemyid:6,position:{x:3822.8622222222225,y:531.9795873086309}},{enemyid:6,position:{x:2697.2586666666666,y:439.0791608115769}},{enemyid:6,position:{x:4144.366222222223,y:758.1719300840666}},{enemyid:7,position:{x:4554.069333333334,y:939.9336341000419}},{enemyid:7,position:{x:4582.343111111111,y:1339.8093829351872}},{enemyid:7,position:{x:4158.236444444445,y:1570.0408746887556}},{enemyid:7,position:{x:3843.1857777777777,y:1230.7523605256022}},{enemyid:8,position:{x:4489.443555555556,y:935.8944851219092}},{enemyid:8,position:{x:4618.695111111111,y:1283.2612972413283}},{enemyid:8,position:{x:3779.409777777778,y:1432.709809432241}},{enemyid:8,position:{x:2312.4373333333333,y:1242.8698074600004}},{enemyid:8,position:{x:3000.583111111111,y:1557.9234277543574}},{enemyid:8,position:{x:5709.841777777778,y:1675.0587481202078}},{enemyid:8,position:{x:6206.712888888889,y:1323.652787022656}},{enemyid:8,position:{x:7232.903111111111,y:1158.047678919212}},{enemyid:9,position:{x:5669.767111111111,y:935.8944851219092}},{enemyid:9,position:{x:3718.7555555555555,y:948.0119320563074}},{enemyid:9,position:{x:2999.6728888888892,y:935.8944851219092}}],EnemyDatas=[{name:"groundAnim",anim:"default"},{name:"flAnim",anim:"swim"},{name:"gcAnim",anim:"swim"},{name:"jfAnim",anim:"float"},{name:"lfAnim",anim:"swim"},{name:"octopusAnim",anim:"swim"},{name:"sgAnim",anim:"fly"},{name:"sfAnim",anim:"jab"},{name:"gfAnim",anim:"swim"},{name:"turtleAnim",anim:"walk"},{name:"lobsterAnim",anim:"both_attack"},{name:"c1Anim",anim:"both_attack"},{name:"c2Anim",anim:"both_attack"},{name:"fireballAnim",anim:"fire"},{name:"ultiAnim",anim:"ulti"}],Enemy=function(a,b){var c;switch(a){case 0:break;case 1:c=new FL(b);break;case 2:c=new GC(b);break;case 3:c=new JF(b);break;case 4:c=new LF(b);break;case 5:c=new Octopus(b);break;case 6:c=new SG(b);break;case 7:c=new SF(b);break;case 8:c=new GF(b);break;case 9:c=new Turtle(b);break;case 10:c=new GC(b)}return c.init(),c};Enemy.load=function(){for(var a in AllEnemies){var b=AllEnemies[a];new Enemy(b.enemyid,b.position)}ED.addEventListener("print",Enemy.print)},Enemy.print=function(){var a=JSON.stringify(AllEnemies),b=new Blob([a],{type:"text/plain;charset=utf-8"});saveAs(b,"enemies.txt")},Enemy.prototype.init=function(a){var b=EnemyDatas[a];this.sprite=new PIXI.Spine(Loader.path[b.name]),this.sprite.position=this.position,this.sprite.scale={x:.5,y:.5},this.sprite.state.setAnimationByName(b.anim,!0),Gamespace.sprite.addChildAt(this.sprite,0)};var FL=function(a){Circle.prototype.constructor.call(this,a,10)};FL.prototype=new Circle,FL.prototype.init=function(){Enemy.prototype.init.call(this,1)},FL.prototype.render=function(){this.collideCircle(SSL)&&"swim"===this.sprite.state.current.name&&(this.sprite.state.setAnimationByName("dead"),SSL.sprite.state.setAnimationByName("flip"),SSL.canFire=!0)};var fl1=new FL({x:1e3,y:1024}),GC=function(a){Circle.prototype.constructor.call(this,a,10)};GC.prototype=new Circle,GC.prototype.init=function(){Enemy.prototype.init.call(this,2)},GC.prototype.render=function(){return this.dead?void(this.sprite.state.isComplete()&&(console.log("xxx"),this.sprite.visible=!1)):void(this.collideCircle(FB)&&(this.sprite.state.setAnimationByName("dead"),this.dead=!0))};var JF=function(a){Circle.prototype.constructor.call(this,a,20)};JF.prototype=new Circle,JF.prototype.init=function(){this.A=5,this.t=0,Enemy.prototype.init.call(this,3)},JF.prototype.render=function(){this.dead||(this.y=this.position.y+this.A*Math.cos(this.t),this.sprite.position.y=this.y,this.t+=.05,this.collideCircle(SSL)?("float"===this.sprite.state.current.name&&this.sprite.state.setAnimationByName("attack"),"ultimate"!==SSL.sprite.state.current.name&&SSL.sprite.state.setAnimationByName("ultimate")):this.collideCircle(FB)&&("float"===this.sprite.state.current.name&&this.sprite.state.setAnimationByName("dead"),this.dead=!0))};var jf1=new JF({x:2500,y:1500}),LF=function(a){Circle.prototype.constructor.call(this,a,20)};LF.prototype=new Circle,LF.prototype.init=function(){this.vx=-1,Enemy.prototype.init.call(this,4)},LF.prototype.render=function(){this.dead||(this.collideCircle(SSL)?("swim"===this.sprite.state.current.name&&this.sprite.state.setAnimationByName("swim"),"ultimate"!==SSL.sprite.state.current.name&&SSL.sprite.state.setAnimationByName("ultimate")):this.collideCircle(FB)&&("swim"===this.sprite.state.current.name&&this.sprite.state.setAnimationByName("dead"),this.dead=!0),Circle.prototype.render.call(this))};var lf1=new LF({x:2500,y:1200}),Octopus=function(a){Circle.prototype.constructor.call(this,a,20)};Octopus.prototype=new Circle,Octopus.prototype.init=function(){Enemy.prototype.init.call(this,5)},Octopus.prototype.render=function(){this.collideCircle(SSL)?("swim"===this.sprite.state.current.name&&this.sprite.state.setAnimationByName("attack"),"ultimate"!==SSL.sprite.state.current.name&&SSL.sprite.state.setAnimationByName("ultimate")):this.collideCircle(FB)&&("swim"===this.sprite.state.current.name&&this.sprite.state.setAnimationByName("dead"),this.dead=!0)};var o=new Octopus({x:2800,y:1200}),SG=function(a){Circle.prototype.constructor.call(this,a,20)};SG.prototype=new Circle,SG.prototype.init=function(){Enemy.prototype.init.call(this,6)},SG.prototype.render=function(){if(this.dead){for(var a in World.dashes){var b=World.dashes[a],c=this.collideDash(b);0!==c&&(-1===c?(this.vy>0&&(this.vy=0),this.ay>0&&(this.ay=0)):1===c&&(this.vy<0&&(this.vy=-.5*this.vy),this.ay<0&&(this.ay=0)))}return void Circle.prototype.render.call(this)}this.collideCircle(FB)&&("fly"===this.sprite.state.current.name&&this.sprite.state.setAnimationByName("dead"),this.dead=!0,this.ay=.7)};var sg1=new SG({x:3e3,y:700}),SF=function(a){Circle.prototype.constructor.call(this,a,20)};SF.prototype=new Circle,SF.prototype.init=function(){this.vx=2,Enemy.prototype.init.call(this,7)},SF.prototype.render=function(){this.dead||(this.collideCircle(SSL)?("jab"===this.sprite.state.current.name&&this.sprite.state.setAnimationByName("jab",!0),"ultimate"!==SSL.sprite.state.current.name&&SSL.sprite.state.setAnimationByName("ultimate")):this.collideCircle(FB)&&("jab"===this.sprite.state.current.name&&this.sprite.state.setAnimationByName("dead"),this.dead=!0),Circle.prototype.render.call(this))};var sf1=new SF({x:1700,y:1600}),GF=function(a){Circle.prototype.constructor.call(this,a,20)};GF.prototype.init=function(){this.A=5,this.t=0,Enemy.prototype.init.call(this,8)},GF.prototype.render=function(){this.dead||(this.x=this.position.x+this.A*Math.cos(this.t),this.sprite.position.y=this.y,this.t+=.05,Circle.prototype.render.call(this))};var gf1=new GF({x:1500,y:1500}),Turtle=function(a){Circle.prototype.constructor.call(this,a,20)};Turtle.prototype=new Circle,Turtle.prototype.init=function(){this.t=0,this.counter=0,Enemy.prototype.init.call(this,9)},Turtle.prototype.render=function(){this.dead||(this.vx=this.counter?0:-1,this.collideCircle(FB)&&("dead"!==this.sprite.state.current.name&&(this.counter<10?this.sprite.state.setAnimationByName("defend"):(this.sprite.state.setAnimationByName("dead"),this.dead=!0)),this.counter++),Circle.prototype.render.call(this))};var t1=new Turtle({x:3e3,y:950}),Lobster=function(){},Camera=function(){function a(){Gamespace.isEditing?(Input.keys.A&&(f.x-=c),Input.keys.D&&(f.x+=c),Input.keys.W&&(f.y-=c),Input.keys.S&&(f.y+=c),Input.keys.Z&&(b*=1.01),Input.keys.X&&(b/=1.01),Input.keys.C&&(foregroundUnit*=1.01),Input.keys.V&&(foregroundUnit/=1.01),Input.keys.B&&(backgroundUnit*=1.01),Input.keys.N&&(backgroundUnit/=1.01),.25>b&&(b=.25),b>1&&(b=1),f.x<d&&(f.x=d),f.x>Gamespace.width-d&&(f.x=Gamespace.width-d),f.y<e&&(f.y=e),f.y>Gamespace.height-e&&(f.y=Gamespace.height-e)):(f.x=SSL.sprite.position.x+300,f.y=SSL.sprite.position.y,b=1,f.x<d&&(f.x=d),f.x>Gamespace.width-d&&(f.x=Gamespace.width-d),f.y<e&&(f.y=e),f.y>Gamespace.height-e&&(f.y=Gamespace.height-e)),Background.focus(f,b),Foreground.focus(f,b),Gamespace.focus(f,b)}var b=1,c=20,d=Screen.width/2+768,e=Screen.height/2+256,f={x:0,y:0};return{render:a}}(),Renderer=function(){function a(){var a=$(window).width(),b=$(window).height();b/a>640/1136?(e.view.style.width=$(window).width()+"px",e.view.style.height=$(window).width()/1136*640+"px"):(e.view.style.width=$(window).height()/640*1136+"px",e.view.style.height=$(window).height()+"px")}function b(){f=!1,requestAnimFrame(d)}function c(){f=!0}function d(){f||(World.render(),Camera.render(),e.render(Screen.stage),requestAnimFrame(d),stats.update())}var e=new PIXI.autoDetectRenderer(Screen.width,Screen.height),f=!0;return e.view.style.display="block",e.view.style.margin="auto",a(),document.body.appendChild(e.view),$(window).resize(function(){a()}),{play:b,pause:c,resize:a}}();Input.init(),Loader.load();