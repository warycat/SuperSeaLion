console.log("Page Loaded");var Input=function(){function a(a){var b=a.keyCode,c=String.fromCharCode(b);9===b&&(a.preventDefault(),ED.dispatchEvent({type:"tab"})),-1!==f.indexOf(c)&&(a.preventDefault(),d[c]=!0,e&&console.log(c)," "===c&&ED.dispatchEvent({type:"space"}),"Q"===c&&ED.dispatchEvent({type:"jump"}),"E"===c&&ED.dispatchEvent({type:"fire"}))}function b(a){var b=a.keyCode,c=String.fromCharCode(b);-1!==f.indexOf(c)&&(a.preventDefault(),d[c]=!1,e&&console.log(c))}function c(){window.addEventListener("keydown",a),window.addEventListener("keyup",b)}var d={},e=!1,f="ASDQWEZXCVBN ";return{init:c,keys:d}}(),Loader=function(){function a(){f.load()}var b="images/",c={backgroundImage:"background3.png",foregroundImage:"foreground3.png",gamespaceImage:"random_trans.png",atlasJson:"atlas.json",atlasImage:"atlas.png",sslAnim:"ssl.anim",fireballAnim:"fireball.anim",ultiAnim:"ulti.anim",groundAnim:"ground.anim",flAnim:"fl.anim",gcAnim:"gc.anim",jfAnim:"jf.anim",lfAnim:"lf.anim",octopusAnim:"octopus.anim",sgAnim:"sg.anim",sfAnim:"sf.anim",gfAnim:"gf.anim",turtleAnim:"turtle.anim",lobsterAnim:"lobster.anim",c1Anim:"c1.anim",c2Anim:"c2.anim"},d={};_.each(c,function(a,c){d[c]=b+a});var e=_.map(c,function(a){return b+a});console.log(d),console.log(e);var f=new PIXI.AssetLoader(e);return f.onComplete=function(){Background.init(),Foreground.init(),Gamespace.init(),SSL.init(),Renderer.play()},{assets:c,path:d,load:a}}(),stats=new Stats;stats.setMode(0),stats.domElement.style.position="absolute",stats.domElement.style.left="0px",stats.domElement.style.top="0px",document.body.appendChild(stats.domElement);var Screen=function(){var a=1136,b=640,c=new PIXI.Stage(15794175,!0);return{width:a,height:b,stage:c}}(),Layer=function(a){this.unit=a};Layer.prototype.width=20480,Layer.prototype.height=2048,Layer.prototype.imageWidth=5120,Layer.prototype.imageHeight=512,Layer.prototype.init=function(){this.sprite.x=Screen.width/2,this.sprite.y=Screen.height/2,this.sprite.scale={x:this.scale,y:this.scale},Screen.stage.addChild(this.sprite)},Layer.prototype.focus=function(a,b){var c=a.x/Layer.prototype.width,d=a.y/Layer.prototype.height;this.sprite.scale={x:this.scale*this.unit*b,y:this.scale*this.unit*b},this.sprite.x=Screen.width/2-a.x+this.width*(1-this.unit*b)*c,this.sprite.y=Screen.height/2-a.y+this.height*(1-this.unit*b)*d};var Background=new Layer(.6);Background.init=function(){this.sprite=new PIXI.DisplayObjectContainer;var a=PIXI.Texture.fromImage(Loader.path.backgroundImage);this.tiles=new PIXI.TilingSprite(a,Layer.prototype.imageWidth,Layer.prototype.imageHeight),this.sprite.addChild(this.tiles),this.scale=4,Layer.prototype.init.call(this)};var Foreground=new Layer(.8);Foreground.init=function(){var a=PIXI.Texture.fromImage(Loader.path.foregroundImage);this.sprite=new PIXI.TilingSprite(a,Layer.prototype.imageWidth,Layer.prototype.imageHeight),this.scale=4,Layer.prototype.init.call(this)};var Gamespace=new Layer(1);Gamespace.init=function(){this.isEditing=!1,this.enemyID=0,ED.addEventListener("tab",Gamespace.edit),ED.addEventListener("new",Gamespace.spawn),ED.addEventListener("space",Gamespace.change),this.sprite=new PIXI.DisplayObjectContainer;var a=PIXI.Texture.fromImage(Loader.path.gamespaceImage);this.tiles=new PIXI.TilingSprite(a,this.width,this.height),this.tiles.visible=!1,this.sprite.setInteractive(!0),this.sprite.hitArea=new PIXI.Rectangle(0,0,Layer.prototype.width,Layer.prototype.height),this.sprite.mousedown=function(a){var b=a.getLocalPosition(Gamespace.sprite);Gamespace.isEditing&&ED.dispatchEvent({type:"new",position:b})},this.sprite.addChild(this.tiles),this.scale=1,Layer.prototype.init.call(this),this.setup()},Gamespace.edit=function(){Gamespace.isEditing=!Gamespace.isEditing,Gamespace.tiles.visible=Gamespace.isEditing},Gamespace.setup=function(){},Gamespace.change=function(){Gamespace.isEditing&&(Gamespace.enemyID++,Gamespace.enemyID>14&&(Gamespace.enemyID=0))},Gamespace.spawn=function(a){{var b=a.position;new Enemy(Gamespace.enemyID,b)}};var World=function(){};World.circles=[],World.dash=[],World.render=function(){for(var a in World.circles){var b=World.circles[a];b.render()}};var Dash=function(a,b){this.position=a,this.length=b,World.dash.push(this)},Circle=function(a,b){this.x=a.x,this.y=a.y,this.vx=0,this.vy=0,this.ax=0,this.ay=0,this.position=a,this.length=b,World.circles.push(this)};Circle.prototype.render=function(){this.vx=this.vx+this.ax,this.vy=this.vy+this.ay,this.vx=this.vx<-this.mvx?-this.mvx:this.vx,this.vx=this.vx>this.mvx?this.mvx:this.vx,this.vy=this.vy<-this.mvy?-this.mvy:this.vy,this.vy=this.vy>this.mvy?this.mvy:this.vy,this.x=this.x+this.vx,this.y=this.y+this.vy,this.x=this.x<0?0:this.x,this.x=this.x>Gamespace.width?Gamespace.width:this.x,this.y=this.y<0?0:this.y,this.y=this.y>Gamespace.height?Gamespace.height:this.y,this.sprite.position={x:this.x,y:this.y}},Circle.prototype.collideCircle=function(a){var b=this.position.x,c=this.position.y,d=a.position.x,e=a.position.y,f=(b-d)*(b-d)+(c-e)*(c-e),g=(this.length+a.length)*(this.length+a.length);return f>g},Circle.prototype.collideDash=function(a){var b=this.position.x,c=this.position.y,d=a.position.x,e=a.position.y,f=this.length,g=a.length;return b>d&&d+g>b&&c>e-f&&e+f>c},Circle.prototype.gravity=function(){return this.y<1024?1:0};var SSL=new Circle({x:0,y:1024});SSL.init=function(){ED.addEventListener("jump",SSL.jump),ED.addEventListener("fire",SSL.fire),this.mvx=10,this.mvy=100,this.speed=1,this.sprite=new PIXI.Spine(Loader.path.sslAnim),this.sprite.position=this.position,this.sprite.scale={x:.5,y:.5},this.sprite.state.setAnimationByName("swim",!0),Gamespace.sprite.addChild(this.sprite),this.vx=5},SSL.render=function(){this.ay=this.gravity();var a=this.sprite.state;"jump"===a.current.name&&a.isComplete()&&a.setAnimationByName("run"),Circle.prototype.render.call(SSL)},SSL.jump=function(){("jump"!==SSL.sprite.state.current.name||SSL.sprite.state.isComplete())&&(SSL.vy=-25,SSL.sprite.state.setAnimationByName("jump"))};var EnemyDatas=[{name:"groundAnim",anim:"default"},{name:"flAnim",anim:"swim"},{name:"gcAnim",anim:"swim"},{name:"jfAnim",anim:"float"},{name:"lfAnim",anim:"swim"},{name:"octopusAnim",anim:"swim"},{name:"sgAnim",anim:"fly"},{name:"sfAnim",anim:"swim"},{name:"gfAnim",anim:"swim"},{name:"turtleAnim",anim:"walk"},{name:"lobsterAnim",anim:"both_attack"},{name:"c1Anim",anim:"both_attack"},{name:"c2Anim",anim:"both_attack"},{name:"fireballAnim",anim:"fire"},{name:"ultiAnim",anim:"ulti"}],Enemy=function(a,b){var c=EnemyDatas[a];console.log(Loader.path[c.name],b);var d=new PIXI.Spine(Loader.path[c.name]);d.position=b,d.scale={x:.5,y:.5},d.state.setAnimationByName(c.anim,!0),Gamespace.sprite.addChild(d)},Camera=function(){function a(){Gamespace.isEditing?(Input.keys.A&&(f.x-=c),Input.keys.D&&(f.x+=c),Input.keys.W&&(f.y-=c),Input.keys.S&&(f.y+=c),Input.keys.Z&&(b*=1.01),Input.keys.X&&(b/=1.01),Input.keys.C&&(foregroundUnit*=1.01),Input.keys.V&&(foregroundUnit/=1.01),Input.keys.B&&(backgroundUnit*=1.01),Input.keys.N&&(backgroundUnit/=1.01),.25>b&&(b=.25),b>1&&(b=1),f.x<d&&(f.x=d),f.x>Gamespace.width-d&&(f.x=Gamespace.width-d),f.y<e&&(f.y=e),f.y>Gamespace.height-e&&(f.y=Gamespace.height-e)):(f.x=SSL.sprite.position.x,f.y=SSL.sprite.position.y,b=1,f.x<d&&(f.x=d),f.x>Gamespace.width-d&&(f.x=Gamespace.width-d),f.y<e&&(f.y=e),f.y>Gamespace.height-e&&(f.y=Gamespace.height-e)),Background.focus(f,b),Foreground.focus(f,b),Gamespace.focus(f,b)}var b=1,c=20,d=Screen.width/2+768,e=Screen.height/2+256,f={x:0,y:0};return{render:a}}(),Renderer=function(){function a(){var a=$(window).width(),b=$(window).height();b/a>640/1136?(e.view.style.width=$(window).width()+"px",e.view.style.height=$(window).width()/1136*640+"px"):(e.view.style.width=$(window).height()/640*1136+"px",e.view.style.height=$(window).height()+"px")}function b(){f=!1,requestAnimFrame(d)}function c(){f=!0}function d(){f||(World.render(),Camera.render(),e.render(Screen.stage),requestAnimFrame(d),stats.update())}var e=new PIXI.autoDetectRenderer(Screen.width,Screen.height),f=!0;return e.view.style.display="block",e.view.style.margin="auto",a(),document.body.appendChild(e.view),$(window).resize(function(){a()}),{play:b,pause:c,resize:a}}();Input.init(),Loader.load();