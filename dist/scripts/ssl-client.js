console.log("Page Loaded");var Input=function(){function a(a){var b=a.keyCode,c=String.fromCharCode(b);9===b&&(a.preventDefault(),ED.dispatchEvent({type:"tab"})),-1!==f.indexOf(c)&&(a.preventDefault(),d[c]=!0,e&&console.log(c)," "===c&&ED.dispatchEvent({type:"space"}))}function b(a){var b=a.keyCode,c=String.fromCharCode(b);-1!==f.indexOf(c)&&(a.preventDefault(),d[c]=!1,e&&console.log(c))}function c(){window.addEventListener("keydown",a),window.addEventListener("keyup",b)}var d={},e=!1,f="ASDQWEZXCVBN ";return{init:c,keys:d}}(),Loader=function(){function a(){f.load()}var b="images/",c={backgroundImage:"background2.png",foregroundImage:"foreground2.png",gamespaceImage:"random_trans.png",atlasJson:"atlas.json",atlasImage:"atlas.png",sslAnim:"ssl.anim",flAnim:"fl.anim",gcAnim:"gc.anim",jfAnim:"jf.anim",lfAnim:"lf.anim",octopusAnim:"octopus.anim",sgAnim:"sg.anim",sfAnim:"sf.anim",lobsterAnim:"lobster.anim",c1Anim:"c1.anim",c2Anim:"c2.anim"},d={};_.each(c,function(a,c){d[c]=b+a});var e=_.map(c,function(a){return b+a});console.log(d),console.log(e);var f=new PIXI.AssetLoader(e);return f.onComplete=function(){Background.init(),Foreground.init(),Gamespace.init(),SSL.init(),Renderer.play()},{assets:c,path:d,load:a}}(),stats=new Stats;stats.setMode(0),stats.domElement.style.position="absolute",stats.domElement.style.left="0px",stats.domElement.style.top="0px";var Screen=function(){var a=1136,b=640,c=new PIXI.Stage(15794175,!0);return{width:a,height:b,stage:c}}(),Layer=function(a){this.unit=a};Layer.prototype.width=20480,Layer.prototype.height=2048,Layer.prototype.imageWidth=5120,Layer.prototype.imageHeight=512,Layer.prototype.init=function(){this.sprite.x=Screen.width/2,this.sprite.y=Screen.height/2,this.sprite.scale={x:this.scale,y:this.scale},Screen.stage.addChild(this.sprite)},Layer.prototype.focus=function(a,b){var c=a.x/Layer.prototype.width,d=a.y/Layer.prototype.height;this.sprite.scale={x:this.scale*this.unit*b,y:this.scale*this.unit*b},this.sprite.x=Screen.width/2-a.x+this.width*(1-this.unit*b)*c,this.sprite.y=Screen.height/2-a.y+this.height*(1-this.unit*b)*d};var Background=new Layer(.6);Background.init=function(){this.sprite=new PIXI.DisplayObjectContainer;var a=PIXI.Texture.fromImage(Loader.path.backgroundImage);this.tiles=new PIXI.TilingSprite(a,Layer.prototype.imageWidth,Layer.prototype.imageHeight),this.sprite.addChild(this.tiles),this.scale=4,Layer.prototype.init.call(this)};var Foreground=new Layer(.8);Foreground.init=function(){var a=PIXI.Texture.fromImage(Loader.path.foregroundImage);this.sprite=new PIXI.TilingSprite(a,Layer.prototype.imageWidth,Layer.prototype.imageHeight),this.scale=4,Layer.prototype.init.call(this)};var Gamespace=new Layer(1);Gamespace.init=function(){this.isEditing=!1,this.enemyID=1,ED.addEventListener("tab",Gamespace.edit),ED.addEventListener("new",Gamespace.spawn),ED.addEventListener("space",Gamespace.change),this.sprite=new PIXI.DisplayObjectContainer;var a=PIXI.Texture.fromImage(Loader.path.gamespaceImage);this.tiles=new PIXI.TilingSprite(a,this.width,this.height),this.tiles.visible=!1,this.sprite.setInteractive(!0),this.sprite.hitArea=new PIXI.Rectangle(0,0,Layer.prototype.width,Layer.prototype.height),this.sprite.mousedown=function(a){var b=a.getLocalPosition(Gamespace.sprite);Gamespace.isEditing&&ED.dispatchEvent({type:"new",position:b})},this.sprite.addChild(this.tiles),this.scale=1,Layer.prototype.init.call(this),this.setup()},Gamespace.edit=function(){Gamespace.isEditing=!Gamespace.isEditing,Gamespace.tiles.visible=Gamespace.isEditing},Gamespace.setup=function(){},Gamespace.change=function(){Gamespace.isEditing&&(Gamespace.enemyID++,Gamespace.enemyID>8&&(Gamespace.enemyID=1))},Gamespace.spawn=function(a){{var b=a.position;new Enemy(Gamespace.enemyID,b)}};var SSL=function(){function a(){var a=new PIXI.Spine(Loader.path.sslAnim);a.position={x:1e3,y:1024},a.scale={x:.5,y:.5},a.state.setAnimationByName("swim",!0),Gamespace.sprite.addChild(a),this.sprite=a}var b,c=100,d=100,e=10,f={x:1,y:1},g={x:10,y:10},h={x:0,y:0};return{width:c,height:d,health:e,center:h,velocity:g,acceleration:f,init:a,sprite:b}}(),EnemyDatas=[{name:"flAnim",anim:"swim"},{name:"gcAnim",anim:"swim"},{name:"jfAnim",anim:"float"},{name:"lfAnim",anim:"swim"},{name:"octopusAnim",anim:"swim"},{name:"sgAnim",anim:"fly"},{name:"sfAnim",anim:"swim"},{name:"lobsterAnim",anim:"both_attack"}],Enemy=function(a,b){var c=EnemyDatas[a-1];console.log(Loader.path[c.name],b);var d=new PIXI.Spine(Loader.path[c.name]);d.position=b,d.scale={x:.5,y:.5},d.state.setAnimationByName(c.anim,!0),Gamespace.sprite.addChild(d)},Camera=function(){function a(){SSL.sprite.position.x+=10,Gamespace.isEditing?(Input.keys.A&&(f.x-=c),Input.keys.D&&(f.x+=c),Input.keys.W&&(f.y-=c),Input.keys.S&&(f.y+=c),Input.keys.Z&&(b*=1.01),Input.keys.X&&(b/=1.01),Input.keys.C&&(foregroundUnit*=1.01),Input.keys.V&&(foregroundUnit/=1.01),Input.keys.B&&(backgroundUnit*=1.01),Input.keys.N&&(backgroundUnit/=1.01),.25>b&&(b=.25),b>1&&(b=1),f.x<d&&(f.x=d),f.x>Gamespace.width-d&&(f.x=Gamespace.width-d),f.y<e&&(f.y=e),f.y>Gamespace.height-e&&(f.y=Gamespace.height-e)):(Input.keys.Q&&(SSL.sprite.position.y+=c),Input.keys.E&&(SSL.sprite.position.y-=c),f.x=SSL.sprite.position.x,f.y=SSL.sprite.position.y,b=1,f.x<d&&(f.x=d),f.x>Gamespace.width-d&&(f.x=Gamespace.width-d),f.y<e&&(f.y=e),f.y>Gamespace.height-e&&(f.y=Gamespace.height-e)),Background.focus(f,b),Foreground.focus(f,b),Gamespace.focus(f,b)}var b=1,c=20,d=Screen.width/2+768,e=Screen.height/2+256,f={x:0,y:0};return{render:a}}(),Renderer=function(){function a(){e.view.style.width=$(window).width()+"px",e.view.style.height=$(window).width()/1136*640+"px"}function b(){f=!1,requestAnimFrame(d)}function c(){f=!0}function d(){f||(Camera.render(),e.render(Screen.stage),requestAnimFrame(d),stats.update())}var e=new PIXI.autoDetectRenderer(Screen.width,Screen.height),f=!0;return e.view.style.display="block",e.view.style.margin="auto",a(),document.body.appendChild(e.view),$(window).resize(function(){a()}),{play:b,pause:c,resize:a}}();Input.init(),Loader.load();